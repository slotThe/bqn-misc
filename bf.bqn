# A brainfuck interpreter.

P â† { # Parse
  ts â† âˆŠâŸœ"><+-[],."âŠ¸/ ð•©            # tokens
  ls â† (â‰ ts)â¥Š0                     # loops
  oâ†'['=ts â‹„ câ†']'=ts â‹„ dâ†+`(o-c)  # depth ordering
  { ab â† âŸ¨ð•©, âŠ‘ð•©+1âŠËœ(ð•©âŠ‘d)>ð•©â†“dâŸ©      # associate "[" with matching "]"
    ls(âŒ½ab)âŒ¾(abâŠ¸âŠ)â†© â‹„@
  }Â¨/o
  tsâ€¿ls
}
P"++ > +++++ [< + > -] ++++ ++++ [< +++ +++ > -] < ."
# â‡’ âŸ¨ "++>+++++[<+>-]++++++++[<++++++>-]<."
#      âŸ¨ 0 0 0 0 0 0 0 0 13 0 0 0 0 8 0 0 0 0 0 0 0 0 32 0 0 0 0 0 0 0 0 0 22 0 0 âŸ©
#    âŸ©

E â† { # Execute
  tsâ€¿ls â† Pð•©      # Tokens and loops
  a   â† 30000â¥Š0   # working tape
  ip  â† 0         # instruction pointer
  dp  â† 0         # data        pointer
  out â† âŸ¨âŸ©
  {ð•ŠÂ·:
    { '>': dp+â†©1;
      '<': dp-â†©1;
      '+': a+âŸœ1âŒ¾(dpâŠ¸âŠ‘)â†© â‹„@;
      '-': a-âŸœ1âŒ¾(dpâŠ¸âŠ‘)â†© â‹„@;
      '.': out âˆ¾â†© <dpâŠ‘a â‹„@;
      '[': {ð•Š0: ipâ†©ipâŠ‘ls; @       }dpâŠ‘a;
      ']': {ð•Š0: @       ; ipâ†©ipâŠ‘ls}dpâŠ‘a;
      ',': {ð•Š0: ipâ†©â‰ ts;        # An EOF input signals termination
             a(ð•©-@)âŒ¾(dpâŠ¸âŠ‘)â†© â‹„@
           }â€¢term.CharB@
     } ipâŠ‘ts
     ip +â†©1
   }â€¢_while_{
     ð•ŠÂ·: (ipâ‰¥0)âˆ§(ip<â‰ ts)
   }@
   @+out
}

# 2 + 5
â€¢Out E "++>+++++[<+>-]++++++++[<++++++>-]<."

# Hello World!
â€¢Out E"++++++++[>++++[>++>+++>+++>+<<<<-]>+>+>->>+[<]<-]>>.>---.+++++++..+++.>>.<-.<.+++.------.--------.>>+."

# A quine!
â€¢Out E"-->+++>+>+>+>+++++>++>++>->+++>++>+>>>>>>>>>>>>>>>>->++++>>>>->+++>+++>+++>+++>+ ++>+++>+>+>>>->->>++++>+>>>>->>++++>+>+>>->->++>++>++>++++>+>++>->++>++++>+>+>++ >++>->->++>++>++++>+>+>>>>>->>->>++++>++>++>++++>>>>>->>>>>+++>->++++>->->->+++> >>+>+>+++>+>++++>>+++>->>>>>->>>++++>++>++>+>+++>->++++>>->->+++>+>+++>+>++++>>> +++>->++++>>->->++>++++>++>++++>>++[-[->>+[>]++[<]<]>>+[>]<--[++>++++>]+[<]<<++] >>>[>]++++>++++[--[+>+>++++<<[-->>--<<[->-<[--->>+<<[+>+++<[+>>++<<]]]]]]>+++[>+ ++++++++++++++<-]>--.<<<]"

# An interactive Rot13
â€¢Out (@+10)âˆ¾"Enter some text to ROT13 it (exit with EOF):"
â€¢Out E"-,+[-[>>++++[>++++++++<-]<+<-[>+>+>-[>>>]<[[>+<-]>>+>]<<<<<-]]>>>[-]+>--[-[<->+++[-]]]<[++++++++++++<[>-[>+>>]>[+[<+>-]>+>>]<<<<<-]>>[<+>-]>[-[-<<[-]>>]<<[<<->>-]>>]<<[<<+>>-]]<[-]<.[-]<-,+]"
