# A very simple CSV parser.
#
# This deliberately accepts all kinds of CSV that might not exactly be
# RFCÂ 4180 compliant. For example, lines don't necessarily have to have the
# same number of fields (in which case the corresponding list element just has
# fewer elements), and lines may end with commas (in which case the list will
# have an empty list as its last element). I also pretend that CRLF is just LF
# (and in general that CR does not exist).

CSV â‡ { ğ•Šx: ','ğ•Šx;
  [q,s,n] â† ('"'âˆ¾ğ•¨âˆ¾@+10) =âŒœ ğ•©            # Quote, separator, LF
  e  â† â‰ `q                               # Escapes
  sp â† (Â¬e)âˆ§nâˆ¨s                          # Where to split
  d  â† spâˆ¨qâˆ§eâˆ¨Â«âŠ¸<q                       # What to drop
  (0âˆ¾sp/+`(Â¬e)âˆ§n) âŠ” (1-Ëœ(Â¬d)Ã—1+`sp) âŠ” ğ•©  # First split all, then split lines
}
